# name: test/sql/create2_functions.test
# description: Test create2_predict function - CREATE2 address prediction
# group: [quackeccak]

require quackeccak

# ========== CREATE2 PREDICT TESTS ==========

# Test 1: Minimal values
query I
SELECT create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x0000000000000000000000000000000000000000000000000000000000000000',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
) = '0xc660a83b541fde5aed091688b9e015d7e6b8ac61';
----
true

# Test 2: Foundry test address
query I
SELECT create2_predict(
    '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    '0x0000000000000000000000000000000000000000000000000000000000003039',
    '0xef67bed7d52b5d7b41c79c16d9b9ea93946005914ea3213b7fc08c62555eaaf4'
) = '0x644068e837aaf6b821a2c22f4e97e08ccbacbb11';
----
true

# Test 3: Deterministic deployer
query I
SELECT create2_predict(
    '0x4e59b44847b379578588920cA78FbF26c0B4956C',
    '0x00000000000000000000000000000000000000000000000000000000deadbeef',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
) = '0xb76e437e42c2b0673c1946bb97cb337f6b6a3339';
----
true

# Test 4: Max values
query I
SELECT create2_predict(
    '0xFFfFfFffFFfffFFfFFfFFFFFffFFFffffFfFFFfF',
    '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff',
    '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'
) = '0x29f2ea9edce8696dcfbe1c9dcc90de77a7bd252d';
----
true

# Test 5: Minimal proxy bytecode
query I
SELECT create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x0000000000000000000000000000000000000000000000000000000000000001',
    '0xbd1ab8973fc701940fe1252ea00647970bf77e9e293777b24d10d4247adb44f1'
) = '0xafcda66bedacd76e434da13dbbe6c46bd92cc838';
----
true

# Test 6: Salt with pattern
query I
SELECT create2_predict(
    '0x1234567890123456789012345678901234567890',
    '0x00000000000000000000000000000000000000000000000000000000cafebabe',
    '0x1c3374235d773b2189aed115aa13143020fcdbbe86e38f358cf3e4771b2f0244'
) = '0x057795d6b3891f5805d67bc94acf36789cc3871c';
----
true

# Test numeric salt conversion
query I
SELECT create2_predict(
    '0x0000000000000000000000000000000000000001',
    '123',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
) = create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x000000000000000000000000000000000000000000000000000000000000007b',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
);
----
true

# Test NULL parameters
query I
SELECT create2_predict(NULL, '0x00', '0x00') IS NULL;
----
true

query I
SELECT create2_predict('0x00', NULL, '0x00') IS NULL;
----
true

query I
SELECT create2_predict('0x00', '0x00', NULL) IS NULL;
----
true

# Test return format is lowercase with 0x prefix
query I
SELECT create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x0000000000000000000000000000000000000000000000000000000000000000',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
) LIKE '0x%' AND 
create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x0000000000000000000000000000000000000000000000000000000000000000',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
) = LOWER(create2_predict(
    '0x0000000000000000000000000000000000000001',
    '0x0000000000000000000000000000000000000000000000000000000000000000',
    '0xbc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a'
));
----
true

# ========== ERROR CASES ==========

# Test create2_predict with wrong deployer address length
statement error
SELECT create2_predict('0x123', '0x00', '0x00');
----

# Test create2_predict with invalid hex in deployer
statement error
SELECT create2_predict('0xzz00000000000000000000000000000000000001', '0x00', '0x00');
----